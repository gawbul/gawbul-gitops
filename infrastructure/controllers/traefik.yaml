apiVersion: v1
kind: Namespace
metadata:
  name: traefik
  labels:
    toolkit.fluxcd.io/tenant: gawbul
sops:
  age:
    - recipient: age1hvmdhkt8llkq3m00ullewwgycy2ujr8tlhqk6ley07usyexcq9vsz8mymh
      enc: |
        -----BEGIN AGE ENCRYPTED FILE-----
        YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBEcWV3RmVqUUJIaUVjSzVp
        WUJseU1xd2Y1dmRPR2EzQU1iU1F1RDFJeUdBClh4R09BbExCRDN0aDkwRVZ4OXRP
        UC9ROVdEUTI5bWZoUlR1R1lVQUZoZG8KLS0tIDJGSTc0MnNCTUxwWVY2eU1yZ1dQ
        a0ppaFFUa3VzUG54ODNxTkxEaGhrNEEKbL3r33MtVUGsQPEqyifsts04VOfx6kyq
        N67+h8d6aNZz9b0GJhuhed70oJB73Ep4WGXpxacGrHObZ+NRQ5ZoBg==
        -----END AGE ENCRYPTED FILE-----
  lastmodified: "2025-04-12T18:03:54Z"
  mac: ENC[AES256_GCM,data:WN7gec2yixd4dAINoM1u3tI2P+VfBv13rKrhv5+Hf1wOrWuRpNt/gx7uBjUF5VWHZEe+dhIHeQxe4DfEjcYOxpCKiF7iTSmnVw+9KSmWUFuifP29QNHwz9eMFIVxP8FWG/7ovHoNJM40yezT0JrvccQk8ek4gW9eCeuwuvUqnFc=,iv:nX7J/lwMlmaLYKYlNKsYL48t6EN5dxpmAF8/0U3DvAY=,tag:qiG8f9z0JWxMFLs6BRXTQQ==,type:str]
  encrypted_regex: ^(data|stringData)$
  version: 3.10.1
---
apiVersion: v1
kind: Secret
metadata:
  name: traefik-dashboard-auth-secret
  namespace: traefik
type: kubernetes.io/basic-auth
stringData:
  username: ENC[AES256_GCM,data:zJGX3xU=,iv:QdGNvqqtn0ss46TVr7yfGgYy26oVEkOgapthRRRLAik=,tag:OJc4u7BylYbdpWU8dRyItA==,type:str]
  password: ENC[AES256_GCM,data:0a6M1D1zLrKgG8Mdcnq1Ti7fBaWKQb9aWfHNEdKDp93aHUs=,iv:iFDyWwDFUxBDjCCChzVlYLxwLMRn90CPNGkZpaUJKGo=,tag:jM6r8a2LrtP5g8EncChpwA==,type:str]
sops:
  age:
    - recipient: age1hvmdhkt8llkq3m00ullewwgycy2ujr8tlhqk6ley07usyexcq9vsz8mymh
      enc: |
        -----BEGIN AGE ENCRYPTED FILE-----
        YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBEcWV3RmVqUUJIaUVjSzVp
        WUJseU1xd2Y1dmRPR2EzQU1iU1F1RDFJeUdBClh4R09BbExCRDN0aDkwRVZ4OXRP
        UC9ROVdEUTI5bWZoUlR1R1lVQUZoZG8KLS0tIDJGSTc0MnNCTUxwWVY2eU1yZ1dQ
        a0ppaFFUa3VzUG54ODNxTkxEaGhrNEEKbL3r33MtVUGsQPEqyifsts04VOfx6kyq
        N67+h8d6aNZz9b0GJhuhed70oJB73Ep4WGXpxacGrHObZ+NRQ5ZoBg==
        -----END AGE ENCRYPTED FILE-----
  lastmodified: "2025-04-12T18:03:54Z"
  mac: ENC[AES256_GCM,data:WN7gec2yixd4dAINoM1u3tI2P+VfBv13rKrhv5+Hf1wOrWuRpNt/gx7uBjUF5VWHZEe+dhIHeQxe4DfEjcYOxpCKiF7iTSmnVw+9KSmWUFuifP29QNHwz9eMFIVxP8FWG/7ovHoNJM40yezT0JrvccQk8ek4gW9eCeuwuvUqnFc=,iv:nX7J/lwMlmaLYKYlNKsYL48t6EN5dxpmAF8/0U3DvAY=,tag:qiG8f9z0JWxMFLs6BRXTQQ==,type:str]
  encrypted_regex: ^(data|stringData)$
  version: 3.10.1
---
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  name: traefik-tls
  namespace: traefik
spec:
  secretName: traefik-tls
  privateKey:
    algorithm: RSA
    encoding: PKCS1
    size: 2048
  duration: 2160h
  renewBefore: 360h
  isCA: false
  usages:
    - server auth
    - client auth
  subject:
    organizations:
      - cert-manager
  commonName: traefik.kubernetes.local
  dnsNames:
    - traefik.kubernetes.local
    - "*.traefik.svc.cluster.local"
  emailAddresses:
    - gawbul@gmail.com
  issuerRef:
    name: selfsigned-issuer
    kind: ClusterIssuer
    group: cert-manager.io
sops:
  age:
    - recipient: age1hvmdhkt8llkq3m00ullewwgycy2ujr8tlhqk6ley07usyexcq9vsz8mymh
      enc: |
        -----BEGIN AGE ENCRYPTED FILE-----
        YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBEcWV3RmVqUUJIaUVjSzVp
        WUJseU1xd2Y1dmRPR2EzQU1iU1F1RDFJeUdBClh4R09BbExCRDN0aDkwRVZ4OXRP
        UC9ROVdEUTI5bWZoUlR1R1lVQUZoZG8KLS0tIDJGSTc0MnNCTUxwWVY2eU1yZ1dQ
        a0ppaFFUa3VzUG54ODNxTkxEaGhrNEEKbL3r33MtVUGsQPEqyifsts04VOfx6kyq
        N67+h8d6aNZz9b0GJhuhed70oJB73Ep4WGXpxacGrHObZ+NRQ5ZoBg==
        -----END AGE ENCRYPTED FILE-----
  lastmodified: "2025-04-12T18:03:54Z"
  mac: ENC[AES256_GCM,data:WN7gec2yixd4dAINoM1u3tI2P+VfBv13rKrhv5+Hf1wOrWuRpNt/gx7uBjUF5VWHZEe+dhIHeQxe4DfEjcYOxpCKiF7iTSmnVw+9KSmWUFuifP29QNHwz9eMFIVxP8FWG/7ovHoNJM40yezT0JrvccQk8ek4gW9eCeuwuvUqnFc=,iv:nX7J/lwMlmaLYKYlNKsYL48t6EN5dxpmAF8/0U3DvAY=,tag:qiG8f9z0JWxMFLs6BRXTQQ==,type:str]
  encrypted_regex: ^(data|stringData)$
  version: 3.10.1
---
apiVersion: source.toolkit.fluxcd.io/v1
kind: HelmRepository
metadata:
  name: traefik
  namespace: traefik
spec:
  interval: 24h
  url: https://traefik.github.io/charts
sops:
  age:
    - recipient: age1hvmdhkt8llkq3m00ullewwgycy2ujr8tlhqk6ley07usyexcq9vsz8mymh
      enc: |
        -----BEGIN AGE ENCRYPTED FILE-----
        YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBEcWV3RmVqUUJIaUVjSzVp
        WUJseU1xd2Y1dmRPR2EzQU1iU1F1RDFJeUdBClh4R09BbExCRDN0aDkwRVZ4OXRP
        UC9ROVdEUTI5bWZoUlR1R1lVQUZoZG8KLS0tIDJGSTc0MnNCTUxwWVY2eU1yZ1dQ
        a0ppaFFUa3VzUG54ODNxTkxEaGhrNEEKbL3r33MtVUGsQPEqyifsts04VOfx6kyq
        N67+h8d6aNZz9b0GJhuhed70oJB73Ep4WGXpxacGrHObZ+NRQ5ZoBg==
        -----END AGE ENCRYPTED FILE-----
  lastmodified: "2025-04-12T18:03:54Z"
  mac: ENC[AES256_GCM,data:WN7gec2yixd4dAINoM1u3tI2P+VfBv13rKrhv5+Hf1wOrWuRpNt/gx7uBjUF5VWHZEe+dhIHeQxe4DfEjcYOxpCKiF7iTSmnVw+9KSmWUFuifP29QNHwz9eMFIVxP8FWG/7ovHoNJM40yezT0JrvccQk8ek4gW9eCeuwuvUqnFc=,iv:nX7J/lwMlmaLYKYlNKsYL48t6EN5dxpmAF8/0U3DvAY=,tag:qiG8f9z0JWxMFLs6BRXTQQ==,type:str]
  encrypted_regex: ^(data|stringData)$
  version: 3.10.1
---
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: traefik
  namespace: traefik
spec:
  interval: 30m
  chart:
    spec:
      chart: traefik
      version: "*"
      sourceRef:
        kind: HelmRepository
        name: traefik
        namespace: traefik
      interval: 12h
  values:
    ingressRoute:
      dashboard:
        enabled: true
        matchRule: Host(`traefik.kubernetes.local`)
        entryPoints:
          - websecure
        middlewares:
          - name: traefik-dashboard-auth
        tls:
          secretName: traefik-tls
    metrics:
      addInternals: true
      otlp:
        enabled: true
        grpc:
          enabled: true
    tracing:
      addInternals: true
      otlp:
        enabled: true
        grpc:
          enabled: true
    extraObjects:
      - apiVersion: traefik.io/v1alpha1
        kind: Middleware
        metadata:
          name: traefik-dashboard-auth
        spec:
          basicAuth:
            secret: traefik-dashboard-auth-secret
sops:
  age:
    - recipient: age1hvmdhkt8llkq3m00ullewwgycy2ujr8tlhqk6ley07usyexcq9vsz8mymh
      enc: |
        -----BEGIN AGE ENCRYPTED FILE-----
        YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBEcWV3RmVqUUJIaUVjSzVp
        WUJseU1xd2Y1dmRPR2EzQU1iU1F1RDFJeUdBClh4R09BbExCRDN0aDkwRVZ4OXRP
        UC9ROVdEUTI5bWZoUlR1R1lVQUZoZG8KLS0tIDJGSTc0MnNCTUxwWVY2eU1yZ1dQ
        a0ppaFFUa3VzUG54ODNxTkxEaGhrNEEKbL3r33MtVUGsQPEqyifsts04VOfx6kyq
        N67+h8d6aNZz9b0GJhuhed70oJB73Ep4WGXpxacGrHObZ+NRQ5ZoBg==
        -----END AGE ENCRYPTED FILE-----
  lastmodified: "2025-04-12T18:03:54Z"
  mac: ENC[AES256_GCM,data:WN7gec2yixd4dAINoM1u3tI2P+VfBv13rKrhv5+Hf1wOrWuRpNt/gx7uBjUF5VWHZEe+dhIHeQxe4DfEjcYOxpCKiF7iTSmnVw+9KSmWUFuifP29QNHwz9eMFIVxP8FWG/7ovHoNJM40yezT0JrvccQk8ek4gW9eCeuwuvUqnFc=,iv:nX7J/lwMlmaLYKYlNKsYL48t6EN5dxpmAF8/0U3DvAY=,tag:qiG8f9z0JWxMFLs6BRXTQQ==,type:str]
  encrypted_regex: ^(data|stringData)$
  version: 3.10.1
